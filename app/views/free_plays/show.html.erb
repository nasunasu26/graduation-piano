<div class="free-play-container">

  <h1>自由演奏モード</h1>

  <div class="back-link">
    <%= link_to "← スタート画面に戻る", root_path %>
  </div>

  <div class="keyboard">
    <button data-note="C">C</button>
    <button data-note="D">D</button>
    <button data-note="E">E</button>
    <button data-note="F">F</button>
    <button data-note="G">G</button>
    <button data-note="A">A</button>
    <button data-note="B">B</button>
  </div>

</div>

<script nonce="<%= content_security_policy_nonce %>">
  document.addEventListener("DOMContentLoaded", () => {
    console.log("inline JS loaded 🎵");

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioContext;

    const frequencies = {
      C: 261.63,
      D: 293.66,
      E: 329.63,
      F: 349.23,
      G: 392.0,
      A: 440.0,
      B: 493.88,
    };

    document.querySelectorAll(".keyboard button").forEach((key) => {
      key.addEventListener("click", () => {
        if (!audioContext) audioContext = new AudioContext();

        const note = key.dataset.note;
        const osc = audioContext.createOscillator();
        osc.frequency.value = frequencies[note];
        osc.type = "sine";

        osc.connect(audioContext.destination);
        osc.start();
        setTimeout(() => osc.stop(), 300);
      });
    });
  });
</script>
